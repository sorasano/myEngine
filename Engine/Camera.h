#pragma once
#include"Base/DirectXCommon.h"
#include<DirectXMath.h>
#include<d3d12.h>
#include<wrl.h>

#include"Input.h"
#include"Easing.h"

using namespace DirectX;

enum CameraMode {
	STRAIGHTMODE,//直線移動
	PLAYERFOLLOWMODE,//自機に追従
	TITLETOPLAYMODE,//タイトルからプレイ遷移
	BOSSINMODE,//ボス出現演出
	BOSSCLERAMODE,//ボス撃破演出
	BOSSGAMEOVERAMODE,//ボス逃亡演出
	DEBUGMODE,//デバックモード
};

class Camera
{
public:
	static ID3D12Device* device_;

	static void StaticInitialize(ID3D12Device* dev);

	struct ConstBufferCamera {
		XMMATRIX view;
		XMMATRIX projection;
	};

	ConstBufferCamera* constMap = nullptr;
	Microsoft::WRL::ComPtr<ID3D12Resource> constBuff_;

private:

	XMMATRIX matView_ = {};
	XMMATRIX matProjection_ = {};
	XMFLOAT3 eye_ = { 0, 1, 30 };
	XMFLOAT3 target_ = { 0, 0, 0 };
	XMFLOAT3 up_ = { 0, 1, 0 };;

public:


	void Initialize(Input* input);

	void UpdateMatrix();

	void Update(XMFLOAT3 playerPos, XMFLOAT3 bossPos);

	//直線移動モード
	void UpdateStraightMode();
	//プレイヤー追従モード
	void UpdatePlayerFollowMode();

	//タイトルからプレイ遷移更新
	void UpdateTitleToPlayMode();
	//タイトルからプレイ遷移初期化
	void InitializeTitleToPlayMode();

	//デバックモード
	void DebugMode();

	XMMATRIX GetViewProjection()const { return matView_ * matProjection_; }
	XMFLOAT3 GetEye() { return eye_; }
	XMFLOAT3 GetTarget() { return target_; }
	int GetMode() { return mode_; }
	float GetRangeMaxZ() { return rangeMaxZ_; }
	bool GetIsPerformance() { return isPerformance_; }

	void SetEye(XMFLOAT3 eye) { this->eye_ = eye; }
	void SetTarget(XMFLOAT3 target) { this->target_ = target; }
	void SetMode(int mode);

private:

	//入力
	Input* input_ = nullptr;

	float angle_ = 0.1f; // カメラの回転角

	//プレイヤー座標
	XMFLOAT3 playerPos_ = {};
	//ボス座標
	XMFLOAT3 bossPos_ = {};

	//描画最大距離
	float rangeMaxZ_ = 500.0f;
	//プレイヤーとカメラの距離
	float playerRange_ = 30.0f;

	//-----カメラモード-----
	int mode_ = STRAIGHTMODE;

	//カメラ直線移動モードスピード
	float straightModeSpeed_ = 1.0f;

	//-----演出用-----
	//現在座標
	XMFLOAT3 startEye_ = {};
	XMFLOAT3 startTarget_ = {};

	//イージング終了位置
	XMFLOAT3 endEye_ = {};
	XMFLOAT3 endTarget_ = {};

	//現在のデータ保存用
	XMFLOAT3 holdEye_ = {};
	XMFLOAT3 holdTarget_ = {};

	//イージング演出用データ
	Easing easeing_;
	//演出時間
	float easeingTime_ = 3.0f;
	//演出中か
	bool isPerformance_ = false;
	//フェーズ
	int phase_ = 0;
};